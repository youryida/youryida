<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-store, must-revalidate">
    <meta http-equiv="expires" content="0">
    <title>❤️犇犇</title>
    <style>
    * {
        margin: 0;
        padding: 0;
    }

    body {
        width: 100%;
        max-width: 800px;
        margin: 0 auto;
    }

    table {
        border-collapse: collapse;
        width: 100%;
    }

    th,
    td {
        text-align: center;
        font-size: 13px;
        padding: 5px 0;
    }

    th {
        background: #ccc;
        font-size: 14px;
        /* font-size: 14px; */
    }
    </style>
</head>

<body>
    <div id="app">
        <table>
            <thead>
                <tr>
                    <th>期数</th>
                    <th>起息日</th>
                    <!-- <th>退出时间</th> -->
                    <th>利率</th>
                    <th>额度</th>
                    <th>今日计息</th>
                    <th>累积计息</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="(one, index) in info.investors">
                    <td>{{index+1}}</td>
                    <td>{{one.startDay}}</td>
                    <!-- <td>{{one.endDay}}</td> -->
                    <td>{{getCurrentPeriodYearRate(new Date(one.startDay)) | percentageFilter}}</td>
                    <td>{{one.money}}</td>
                    <td>{{todayGains(one) | yuanFilter}}</td>
                    <td>{{totalGains(one) | yuanFilter}}</td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="4"></td>
                    <td>本息总计:</td>
                    <td>{{globalTotalGains | yuanFilter}}</td>
                </tr>
            </tfoot>
        </table>
    </div>
</body>
<script src="https://cdn.bootcss.com/vue/2.5.16/vue.min.js"></script>
<script type="text/javascript">
const _RATE_OF_YEAR = {
    "0": 0.07,
    "90": 0.08
}
const _INVESTORS = [{
    money: 50000,
    startDay: "2018/03/22",
    endDay: "-"
}, {
    money: 20000,
    startDay: "2018/05/11",
    endDay: "-"
}, {
    money: 100000,
    startDay: "2018/05/17",
    endDay: "-"
}, {
    money: 40000,
    startDay: "2018/06/12",
    endDay: "-"
}, {
    money: 50000,
    startDay: "2018/07/12",
    endDay: "-"
}];

const app = new Vue({
    el: '#app',
    data: {
        info: {
            investors: _INVESTORS
        }
    },
    computed: {
        globalTotalGains() {
            return this.info.investors.reduce((num, one) => {
                return num + this.totalGains(one);
            }, 0);
        }
    },
    created() {
        this.gainsAutoRefresh();
        // fetch('http://cs.cdn.sohusce.com/test/weatherData.json')
        //     .then(res => res.json())
        //     .then(json => {
        //         // console.log(json.data)
        //         this.weatherList = json.data.forecast;
        //     })
    },
    filters: {
        yuanFilter(num) {
            return num.toFixed(3);
        },
        percentageFilter(num) {
            return (num * 100).toFixed(0) + '%';
        }
    },
    methods: {
        gainsAutoRefresh() {
            setInterval(x => {
                console.log(11);
                this.info.investors.splice(0, _INVESTORS.length, ..._INVESTORS);
            }, 2000);
        },
        todayGains(one) {
            let baseMoney = one.money;
            let nowDate = new Date();
            let zeroPointDate = new Date(nowDate.toLocaleDateString() + " 00:00:00");
            return this.getDateDiffGains(baseMoney, nowDate, zeroPointDate);
        },
        totalGains(one) {
            let baseMoney = one.money;
            let nowDate = new Date();
            let startDate = new Date(one.startDay + " 00:00:00");
            return this.getDateDiffGains(baseMoney, nowDate, startDate);
        },
        getDateDiffGains(baseMoney, endDate, startDate) {

            let secondsRate = this.getCurrentPeriodYearRate(startDate) / 365 / 24 / 60 / 60;
            let pastSeconds = this.getDateDiffSeconds(endDate, startDate);
            let gains = pastSeconds * secondsRate * baseMoney;
            return gains;
        },
        getDateDiffSeconds(endDate, startDate) {
            return (endDate.getTime() - startDate.getTime()) / 1000;
        },
        /*
        满90天 更高利率
         */
        getCurrentPeriodYearRate(startDate) {
            let nowDate = new Date();
            let pastSeconds = this.getDateDiffSeconds(nowDate, startDate);
            let rate = pastSeconds > 90 * 24 * 60 * 60 ? _RATE_OF_YEAR["90"] : _RATE_OF_YEAR["0"];
            return rate;
        }
    }

});
</script>

</html>