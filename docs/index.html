<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-store, must-revalidate">
    <meta http-equiv="expires" content="0">
    <title>助力北漂❤️感恩有你</title>
    <style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    .ta-l {
        text-align: left;
    }

    .ta-r {
        text-align: right;
    }

    body {
        width: 100%;
        max-width: 800px;
        margin: 0 auto;
    }

    table {
        border-collapse: collapse;
        width: 100%;
    }

    table caption {
        font-size: 16px;
        font-weight: bold;
        margin: 5px auto;
    }

    th,
    td {
        text-align: center;
        font-size: 13px;
        padding: 8px 0;
    }

    thead th {
        border-bottom: 2px solid #333;
        background: #efefef;
        /* padding: 4px 0 4px 0; */
        /* font-size: 14px; */
    }

    tbody tr:nth-of-type(2n) {
        background: #efefef;
    }

    tfoot td {
        border-top: 1px solid #efefef;
        font-size: 10px;
        text-align: left;
        padding: 5px 4px;
    }
    </style>
</head>

<body>
    <div id="app">
        <table>
            <!-- <caption>借款备忘录</caption> -->
            <thead>
                <tr>
                    <th>出借人</th>
                    <th>起息日</th>
                    <th>还款日</th>
                    <th>额度</th>
                    <th>今日计息</th>
                    <th>累积计息</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="one in investors">
                    <td>{{one.name | investorNameFilter}}</td>
                    <td>{{one.startDay}}</td>
                    <td>{{one.endDay}}</td>
                    <td>*</td>
                    <td>{{todayGains(one) | yuanFilter(4)}}</td>
                    <td>{{totalGains(one) | yuanFilter(4)}}</td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td :colspan="ui.table.cols/2">
                        注：次日起息，实时计息
                    </td>
                    <td :colspan="ui.table.cols/2" class="ta-r">
                        <i>via xuefeng 借款备忘录</i>
                    </td>
                </tr>
            </tfoot>
        </table>
    </div>
</body>
<script src="https://cdn.bootcss.com/vue/2.5.16/vue.min.js"></script>
<script type="module">
import money from './assets/js/money.js';
const _AUTO_REFRESH_TIME = 1200;
const _YEAR_RATE_STEP = [
    [0, 0.06]
];
const _INVESTORS = [{
    name: "QiGuoLi",
    money: 20000,
    startDay: "2018/09/01",
    endDay: "2019/03/01"
}, {
    name: "YuJiuSheng",
    money: 20000,
    startDay: "2018/09/08",
    endDay: "2019/03/08"
}, {
    name: "XiaoMingHuan",
    money: 30000,
    startDay: "2018/09/09",
    endDay: "2019/09/09"
}, {
    name: "ZhaoFuYang",
    money: 10000,
    startDay: "2018/09/18",
    endDay: "2019/09/18"
}, {
    name: "LiangDaoBai",
    money: 10000,
    startDay: "2018/09/29",
    endDay: "2019/09/29"
}, {
    name: "ZhangShuai",
    money: 100000,
    startDay: "2018/10/01",
    endDay: "2019/10/01"
}, {
    name: "LiJiKun",
    money: 30000,
    startDay: "2018/10/08",
    endDay: "2019/10/08"
}, {
    name: "TuKe",
    money: 40000,
    startDay: "2018/10/09",
    endDay: "2020/10/09"
}, {
    name: "TuHaoA",
    money: 200000,
    startDay: "2018/10/10",
    endDay: "2018/12/10"
}, {
    name: "FengYinChao",
    money: 50000,
    startDay: "2018/10/16",
    endDay: "2019/10/16"
}];

const app = new Vue({
    el: '#app',
    data: {
        investors: _INVESTORS,
        ui: {
            table: {
                cols: 6
            }
        }
    },
    computed: {
        // totalCounts() {
        //     return this.weatherList.reduce((count, w) => {
        //         return count + w.aqi;
        //     }, 0);
        // }
    },
    created() {
        this.gainsAutoRefresh();
        // fetch('http://cs.cdn.sohusce.com/test/weatherData.json')
        //     .then(res => res.json())
        //     .then(json => {
        //         // console.log(json.data)
        //         this.weatherList = json.data.forecast;
        //     })
    },
    filters: {
        yuanFilter(num, fixed = 3) {
            return num.toFixed(fixed);
        },
        percentageFilter(num) {
            return (num * 100).toFixed(0) + '%';
        },
        investorNameFilter(name) {
            return name.replace(/(\w+)([A-Z]\w+)/, function(s, m1, m2) {
                return m1.replace(/[a-z]/g, '') + m2;
            })
        }
    },
    methods: {
        gainsAutoRefresh() {
            setInterval(x => {
                this.investors.splice(0, _INVESTORS.length, ..._INVESTORS);
            }, _AUTO_REFRESH_TIME);
        },
        todayGains(one) {
            let baseMoney = one.money;
            let nowDate = new Date(),
                startDate = new Date(one.startDay);
            let zeroPointDate = new Date(nowDate.toLocaleDateString());
            let yearRate = money.getCurrentPeriodYearRate(startDate, _YEAR_RATE_STEP);
            return money.getDateDiffGains(baseMoney, yearRate, zeroPointDate, nowDate);
        },
        totalGains(one) {
            let baseMoney = one.money;
            let nowDate = new Date(),
                startDate = new Date(one.startDay);
            let yearRate = money.getCurrentPeriodYearRate(startDate, _YEAR_RATE_STEP);
            return money.getDateDiffGains(baseMoney, yearRate, startDate, nowDate);
        },
        /*
        计算当期年利率
         */
        calcYearRateByStartDay(startDay) {
            return money.getCurrentPeriodYearRate(new Date(startDay), _YEAR_RATE_STEP)
        }
    }

});
</script>

</html>